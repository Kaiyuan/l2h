import{s as S,a as u,b as B}from"./index-BopUzADT.js";import{f as D,g as E,r as y,o as N,c as g,d as t,a as l,u as a,s as p,w as d,h as T,b as c,t as w,e as V,i as b,j as k}from"./index-BldLFlwi.js";import{s as C}from"./index-DGUChcih.js";import{a as _}from"./index-B9ygI19o.js";const U={class:"card"},j={class:"flex justify-between items-center mb-4"},M={class:"font-mono text-gray-500"},q={key:0,class:"flex flex-column gap-4"},L={class:"flex flex-column gap-2"},R={class:"flex flex-column gap-2"},W={key:1,class:"flex flex-column gap-4"},z={class:"p-3 bg-green-50 rounded border border-green-200"},F={class:"flex gap-2"},Y={__name:"APIKeys",setup(G){const r=D(),$=E(),K=y([]),m=y(!1),f=y(!1),v=y(!1),i=y(""),n=y({name:"",expires_in_days:0}),x=async()=>{m.value=!0;try{const o=await _.get("/api/api-keys");K.value=o.data||[]}catch{r.add({severity:"error",summary:"Error",detail:"无法加载 API Keys",life:3e3})}finally{m.value=!1}},A=()=>{n.value={name:"",expires_in_days:30},i.value="",f.value=!0},I=async()=>{if(!n.value.name){r.add({severity:"warn",summary:"Validation",detail:"名称不能为空",life:3e3});return}v.value=!0;try{const o=await _.post("/api/api-keys",n.value);i.value=o.data.key,r.add({severity:"success",summary:"Success",detail:"Key 生成成功",life:3e3}),x()}catch{r.add({severity:"error",summary:"Error",detail:"生成失败",life:3e3})}finally{v.value=!1}},h=o=>{$.require({message:"确定要删除这个 API Key 吗?",header:"确认删除",icon:"pi pi-exclamation-triangle",accept:async()=>{try{await _.delete(`/api/api-keys/${o}`),r.add({severity:"success",summary:"Success",detail:"删除成功",life:3e3}),x()}catch{r.add({severity:"error",summary:"Error",detail:"删除失败",life:3e3})}}})},P=()=>{navigator.clipboard.writeText(i.value),r.add({severity:"info",summary:"Copied",detail:"已复制到剪贴板",life:2e3})};return N(()=>{x()}),(o,e)=>(c(),g("div",U,[t("div",j,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold"},"API Key 管理",-1)),l(a(p),{label:"生成新 Key",icon:"pi pi-plus",onClick:A})]),l(a(S),{value:K.value,loading:m.value,stripedRows:""},{empty:d(()=>[...e[6]||(e[6]=[V("暂无 API Key",-1)])]),default:d(()=>[l(a(u),{field:"id",header:"ID",sortable:""}),l(a(u),{field:"name",header:"名称",sortable:""}),l(a(u),{field:"key",header:"Key (部分)",sortable:""},{body:d(s=>[t("span",M,w(s.data.key.substring(0,8))+"...",1)]),_:1}),l(a(u),{field:"expires_at",header:"过期时间",sortable:""},{body:d(s=>[V(w(s.data.expires_at?new Date(s.data.expires_at).toLocaleString():"永久有效"),1)]),_:1}),l(a(u),{field:"usage_count",header:"使用次数",sortable:""}),l(a(u),{header:"操作"},{body:d(s=>[l(a(p),{icon:"pi pi-trash",severity:"danger",text:"",rounded:"",onClick:H=>h(s.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),l(a(T),{visible:f.value,"onUpdate:visible":e[4]||(e[4]=s=>f.value=s),header:"生成 API Key",modal:"",style:{width:"500px"}},{footer:d(()=>[i.value?k("",!0):(c(),b(a(p),{key:0,label:"取消",text:"",onClick:e[2]||(e[2]=s=>f.value=!1)})),i.value?k("",!0):(c(),b(a(p),{key:1,label:"生成",onClick:I,loading:v.value},null,8,["loading"])),i.value?(c(),b(a(p),{key:2,label:"完成",onClick:e[3]||(e[3]=s=>f.value=!1)})):k("",!0)]),default:d(()=>[i.value?(c(),g("div",W,[t("div",z,[e[10]||(e[10]=t("p",{class:"text-green-700 font-bold mb-2"},"生成成功! 请立即复制保存，稍微将不再显示。",-1)),t("div",F,[l(a(C),{value:i.value,readonly:"",class:"w-full font-mono bg-white"},null,8,["value"]),l(a(p),{icon:"pi pi-copy",onClick:P})])])])):(c(),g("div",q,[t("div",L,[e[7]||(e[7]=t("label",{for:"name"},"名称 / 描述",-1)),l(a(C),{id:"name",modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.name=s),placeholder:"e.g. My Worker Server"},null,8,["modelValue"])]),t("div",R,[e[8]||(e[8]=t("label",{for:"expires"},"有效期 (天)",-1)),l(a(B),{id:"expires",modelValue:n.value.expires_in_days,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.expires_in_days=s),suffix:" 天"},null,8,["modelValue"]),e[9]||(e[9]=t("small",{class:"text-gray-500"},"设置为 0 表示永久有效",-1))])]))]),_:1},8,["visible"])]))}};export{Y as default};
